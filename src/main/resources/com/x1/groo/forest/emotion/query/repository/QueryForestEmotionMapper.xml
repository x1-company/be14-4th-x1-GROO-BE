<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.x1.groo.forest.emotion.query.repository.QueryForestEmotionMapper">
    <resultMap id="QueryForestUserItemResultMap"
               type="com.x1.groo.forest.emotion.query.dto.QueryForestEmotionUserItemDTO">
        <result property="id" column="id"/>
        <result property="totalCount" column="total_count"/>
        <result property="placedCount" column="placed_count"/>
        <result property="itemId" column="item_id"/>
        <result property="itemName" column="name"/>
        <result property="categoryId" column="category_id"/>
        <result property="imageUrl" column="image_url"/>
    </resultMap>
    <resultMap id="QueryForestMailboxListResultMap"
               type="com.x1.groo.forest.emotion.query.dto.QueryForestEmotionMailboxListDTO">
        <result property="id" column="id"/>
        <result property="createdAt" column="created_at"/>
        <result property="forestId" column="forest_id"/>
    </resultMap>
    <resultMap id="QueryForestMailboxDetailResultMap"
               type="com.x1.groo.forest.emotion.query.dto.QueryForestEmotionMailboxDTO">
        <result property="id" column="id"/>
        <result property="content" column="content"/>
        <result property="createdAt" column="created_at"/>
        <result property="forestId" column="forest_id"/>
        <result property="userId" column="user_id"/>
    </resultMap>

    <select id="findPieceOfMemory" resultMap="QueryForestUserItemResultMap">
        SELECT
               ui.id
             , ui.item_id
             , ui.total_count
             , ui.placed_count
             , i.name
             , i.category_id
             , i.image_url
          FROM user_item ui
          JOIN item i ON ui.item_id = i.id
         WHERE ui.user_id = #{userId}
           AND i.category_id = #{categoryId}
    </select>

    <select id="findMailboxList" resultMap="QueryForestMailboxListResultMap">
        SELECT
               m.id
             , m.created_at
             , m.forest_id
          FROM mailbox m
          JOIN forest f ON m.forest_id = f.id
         WHERE m.forest_id = #{forestId}
           AND m.is_deleted = false
           AND f.is_public = true
         ORDER BY m.created_at DESC;
    </select>

    <select id="findMailboxDetail" resultMap="QueryForestMailboxDetailResultMap">
        SELECT
               m.id
             , m.content
             , m.created_at
             , m.forest_id
             , m.user_id
          FROM mailbox m
          JOIN forest f ON m.forest_id = f.id
         WHERE m.id = #{id}
           AND m.is_deleted = false
           AND f.is_public = true;
    </select>
</mapper>